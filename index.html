<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Examen TI</title>
    <style>
        body { font-family: Arial; margin: 0; background: #f0f0f0; }
        header { background: #4a76ff; padding: 15px; color: white; }
        nav button { margin: 5px; padding: 10px 20px; }
        section { display: none; padding: 20px; }
        .card { background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .stats-box { background: #fff; padding: 15px; border-radius: 10px; margin: 5px 0; }
    </style>
</head>

<body>

<header>
    <h2>Plataforma de Ex√°menes IT</h2>
</header>

<nav>
    <button onclick="mostrarSeccion('login')">Login / Registro</button>
    <button onclick="mostrarSeccion('perfil')">Perfil</button>
    <button onclick="mostrarSeccion('estadisticas')">Estad√≠sticas</button>
    <button onclick="cerrarSesion()">Cerrar Sesi√≥n</button>
</nav>

<!-- LOGIN / REGISTRO -->
<section id="login" style="display:block;">
    <div class="card">
        <h3>Iniciar Sesi√≥n</h3>
        <input id="email" placeholder="Correo"><br><br>
        <input id="password" type="password" placeholder="Contrase√±a"><br><br>
        <button onclick="login()">Entrar</button>
    </div>

    <div class="card">
        <h3>Crear Cuenta</h3>
        <input id="email_reg" placeholder="Correo"><br><br>
        <input id="password_reg" type="password" placeholder="Contrase√±a"><br><br>
        <button onclick="registrar()">Registrar</button>
    </div>
</section>

<!-- PERFIL DEL USUARIO -->
<section id="perfil">
    <h2>Perfil del Usuario</h2>

    <div class="stats-box">
        <p><b>Correo:</b> <span id="perfilCorreo"></span></p>
        <p><b>Mejor Puntuaci√≥n:</b> <span id="perfilMejor"></span></p>
        <p><b>Total de Ex√°menes:</b> <span id="perfilExamenes"></span></p>
        <p><b>Tiempo Total Estudiado:</b> <span id="perfilTiempo"></span> min</p>
    </div>

    <h3>√öltimos ex√°menes</h3>
    <div id="listaExamenes"></div>
</section>

<!-- ESTAD√çSTICAS AVANZADAS -->
<section id="estadisticas">
    <h2>Estad√≠sticas del Usuario</h2>

    <div class="stats-box">
        <h3>Promedio de aciertos</h3>
        <p id="statPromedio">Cargando...</p>
    </div>

    <div class="stats-box">
        <h3>√öltimo examen</h3>
        <p id="statUltimo">Cargando...</p>
    </div>

    <div class="stats-box">
        <h3>Progreso general</h3>
        <p id="statProgreso">Cargando...</p>
    </div>

    <h3>Historial completo</h3>
    <div id="statHistorial"></div>
</section>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>

<script>
    // üî• TU CONFIG ‚Äî reempl√°zala si ya tienes la tuya
    const firebaseConfig = {
        apiKey: "TU_API_KEY",
        authDomain: "TU_AUTH_DOMAIN",
        projectId: "TU_PROJECT_ID",
        storageBucket: "TU_BUCKET",
        messagingSenderId: "TU_SENDER",
        appId: "TU_APPID"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Cambiar pantalla
    function mostrarSeccion(id) {
        document.querySelectorAll("section").forEach(s => s.style.display = "none");
        document.getElementById(id).style.display = "block";
    }

    // Login
    function login() {
        let email = email.value;
        let pass = password.value;

        auth.signInWithEmailAndPassword(email, pass)
            .then(() => cargarPerfil())
            .catch(e => alert(e.message));
    }

    // Registro
    function registrar() {
        let email = email_reg.value;
        let pass = password_reg.value;

        auth.createUserWithEmailAndPassword(email, pass)
            .then(user => {
                db.collection("usuarios").doc(user.user.uid).set({
                    correo: email,
                    mejorPuntuacion: 0,
                    totalExamenes: 0,
                    totalTiempoEstudio: 0,
                    fechaCreacion: new Date()
                });
                cargarPerfil();
            })
            .catch(e => alert(e.message));
    }

    auth.onAuthStateChanged(user => {
        if (user) cargarPerfil();
    });

    // Cerrar sesi√≥n
    function cerrarSesion() {
        auth.signOut();
        mostrarSeccion("login");
    }

    // Cargar perfil b√°sico
    function cargarPerfil() {
        let user = auth.currentUser;
        if (!user) return;

        mostrarSeccion("perfil");

        db.collection("usuarios").doc(user.uid).get().then(doc => {
            let p = doc.data();
            perfilCorreo.textContent = p.correo;
            perfilMejor.textContent = p.mejorPuntuacion;
            perfilExamenes.textContent = p.totalExamenes;
            perfilTiempo.textContent = p.totalTiempoEstudio;
        });

        cargarListaExamenes();
    }

    // Lista de ex√°menes
    function cargarListaExamenes() {
        let user = auth.currentUser;

        db.collection("usuarios").doc(user.uid).collection("examenes")
            .orderBy("fecha", "desc").limit(5)
            .get()
            .then(snapshot => {
                listaExamenes.innerHTML = "";
                snapshot.forEach(doc => {
                    let d = doc.data();
                    listaExamenes.innerHTML += `
                        <div class="card">
                            <b>${doc.id}</b><br>
                            Aciertos: ${d.aciertos}/${d.totalPreguntas}<br>
                            Tiempo: ${d.tiempoTotalUsado}s
                        </div>
                    `;
                });
            });
    }

    // Cargar estad√≠sticas avanzadas
    function cargarEstadisticas() {
        let user = auth.currentUser;
        if (!user) return;

        db.collection("usuarios").doc(user.uid).collection("examenes")
            .orderBy("fecha", "desc")
            .get()
            .then(snapshot => {
                let totalAciertos = 0;
                let totalPreguntas = 0;
                let historialHTML = "";
                let ultimo = null;

                snapshot.forEach((doc, i) => {
                    let d = doc.data();

                    if (i === 0) ultimo = d;

                    totalAciertos += d.aciertos;
                    totalPreguntas += d.totalPreguntas;

                    historialHTML += `
                        <div class="card">
                            <b>${doc.id}</b><br>
                            Aciertos: ${d.aciertos}/${d.totalPreguntas}<br>
                            Tiempo: ${d.tiempoTotalUsado}s
                        </div>
                    `;
                });

                statHistorial.innerHTML = historialHTML;

                if (ultimo) {
                    statUltimo.textContent = `Aciertos: ${ultimo.aciertos}/${ultimo.totalPreguntas}`;
                }

                if (totalPreguntas > 0) {
                    statPromedio.textContent =
                        Math.round((totalAciertos / totalPreguntas) * 100) + "%";
                }

                statProgreso.textContent = snapshot.size + " ex√°menes registrados";
            });
    }

    // Cargar estad√≠sticas cuando abre esa secci√≥n
    document.getElementById("estadisticas").addEventListener("click", cargarEstadisticas);

</script>
</body>
</html>
